# 練習：華台辭典庫

### 目標

我們要完成一個小小的華台辭典庫。  
底下是一份簡化過的華台辭典，總共3個詞目，把它成功存入言語資料庫就可以了。

```
ID,華語對譯,英文,台語羅馬字,台語漢字
1,曾祖父母,grandparents,a-chou2,阿祖
2,爺爺,grandfather,a-kong,阿公
3,媽媽,mother,a-bo2,阿母
```
### 想法

> 首先看看我們需要動到哪些表格才能儲存這個辭典。
>
> 這個辭典是一個csv檔案，沒有包含任何影音或是聽打資料。  
> 因此，我們只需要動到『外語表和文本表』，華語詞和英語詞放到外語表，台語詞放到文本表，就大功告成！

### Github

完成練習的專案在這個[連結](https://github.com/i3thuan5/Hello_huatai_dict)。

### 讀取

根據[安裝步驟](安裝步驟.md)建立一個新專案『Hello\_huatai\_dict』之後，首先，用python內建的`DictReader`將csv字串一一讀取。

```python3
import io
import csv

HuaTaiCsv = """ID,華語對譯,英文,台語羅馬字,台語漢字
1,曾祖父母,grandparents,a-chou2,阿祖
2,爺爺,grandfather,a-kong,阿公
3,媽媽,mother,a-bo2,阿母
"""
f = io.StringIO(HuaTaiCsv)
reader = csv.DictReader(f, delimiter=',')
for 一行 in reader:
    # 待會將一一存入每一行資料
```

### 新增外語詞

加入新函式新增外語詞()，它將負責呼叫API`外語表.加資料()`，把每一行裡頭的華語詞/英文詞存到資料庫。
請注意，`外語表.加資料()`只允許『一次加一個外語詞』，因此原始資料裡頭的一行：
```
曾祖父母,grandparents, ...
```
必須視為兩行：
```
曾祖父母     （華語詞）
grandparents（英文詞）
```

```python3
from 臺灣言語資料庫.資料模型 import 外語表

def 新增外語詞(哪種外語, 外語文字):
    外語資料 = {
        '外語語言': 哪種外語,
        '外語資料': 外語文字.strip(),
    }
    其他欄位 = {
        '收錄者': 來源表.objects.get_or_create(名='麥克華斯基')[0].編號(),
        '來源': 來源表.objects.get_or_create(名='小小華台辭典')[0].編號(),
        '版權': 版權表.objects.get_or_create(版權='會使公開')[0].pk,
        '種類': '字詞',
        '語言腔口': '臺語',
        '著作所在地': '臺灣',
        '著作年': '2017',
    }
    # 將其他欄位合併到外語資料
    外語資料.update(其他欄位)
    # 外語表API：存入外語詞
    一指標 = 外語表.加資料(外語資料)
    return 一指標
```

### 存入對應的台語詞

接著，利用華語詞和英文詞在資料庫的指標（索引），幫它們儲存對應的台語詞到資料庫。

```python3
from 臺灣言語資料庫.資料模型 import 外語表

def 新增外語詞(哪種外語, 外語文字):
    ...

def 新增母語詞(外語指標, 台語羅馬字, 台語漢字):
    文本資料 = {
        '文本資料': 台語漢字,
        '音標資料': 台語羅馬字,
    }
    其他欄位 = {
        '收錄者': 來源表.objects.get_or_create(名='麥克華斯基')[0].編號(),
        '來源': 來源表.objects.get_or_create(名='小小華台辭典')[0].編號(),
        '版權': 版權表.objects.get_or_create(版權='會使公開')[0].pk,
        '種類': '字詞',
        '語言腔口': '臺語',
        '著作所在地': '臺灣',
        '著作年': '2017',
    }
    # 將其他欄位合併到外語資料
    文本資料.update(其他欄位)
    # 外語表API：存入母語詞
    外語指標.翻母語(文本資料)
```

### 呼叫前面兩個函式

修改主程式的for迴圈，呼叫剛剛的新增外語詞()和新增母語詞()，就完成了。

```python3
for row in reader:
    # Step 1. 將華語詞和英語詞加到外語表
    華語指標 = 新增外語詞('華語', row['華語對譯'])
    英文指標 = 新增外語詞('英文', row['英文'])
    # Step 2. 將它們對應的台語詞加到文本表
    新增母語詞(華語指標, row['台語羅馬字'], row['台語漢字'])
    新增母語詞(英文指標, row['台語羅馬字'], row['台語漢字'])
```

## 完整程式碼

`華台辭典.py`

```python3
import io
import csv
from 臺灣言語資料庫.資料模型 import 外語表
from 臺灣言語資料庫.資料模型 import 文本表
from 臺灣言語資料庫.資料模型 import 來源表
from 臺灣言語資料庫.資料模型 import 版權表
from 臺灣言語資料庫.關係模型 import 翻譯文本表
from django.forms.models import model_to_dict
 
def 新增外語詞(哪種外語, 外語文字):
    外語資料 = {
        '外語語言': 哪種外語,
        '外語資料': 外語文字.strip(),
    }
    其他欄位 = {
        '收錄者': 來源表.objects.get_or_create(名='麥克華斯基')[0].編號(),
        '來源': 來源表.objects.get_or_create(名='小小華台辭典')[0].編號(),
        '版權': 版權表.objects.get_or_create(版權='會使公開')[0].pk,
        '種類': '字詞',
        '語言腔口': '臺語',
        '著作所在地': '臺灣',
        '著作年': '2017',
    }
    # 將其他欄位合併到外語資料
    外語資料.update(其他欄位)
    # 外語表API：存入外語詞
    一指標 = 外語表.加資料(外語資料)
    return 一指標

def 新增母語詞(外語指標, 台語羅馬字, 台語漢字):
    文本資料 = {
        '文本資料': 台語漢字,
        '音標資料': 台語羅馬字,
    }
    其他欄位 = {
        '收錄者': 來源表.objects.get_or_create(名='麥克華斯基')[0].編號(),
        '來源': 來源表.objects.get_or_create(名='小小華台辭典')[0].編號(),
        '版權': 版權表.objects.get_or_create(版權='會使公開')[0].pk,
        '種類': '字詞',
        '語言腔口': '臺語',
        '著作所在地': '臺灣',
        '著作年': '2017',
    }
    # 將其他欄位合併到外語資料
    文本資料.update(其他欄位)
    # 外語表API：存入母語詞
    外語指標.翻母語(文本資料)

def 顯示表格():
    print('===外語表===')
    for 一筆 in 外語表.objects.all():
        print(model_to_dict(一筆))
    print('===文本表===')
    for 一筆 in 文本表.objects.all():
        print(model_to_dict(一筆))
    print('===翻譯文本表===')
    for 一對應關係 in 翻譯文本表.objects.all():
        print(model_to_dict(一對應關係))


#
# 主要程式
#    
HuaTaiCsv = """ID,華語對譯,英文,台語羅馬字,台語漢字
1,曾祖父母,grandparents,a-chou2,阿祖
2,爺爺,grandfather,a-kong,阿公
3,媽媽,mother,a-bo2,阿母
"""
f = io.StringIO(HuaTaiCsv)
reader = csv.DictReader(f, delimiter=',')
for row in reader:
    # Step 1. 將華語詞和英語詞加到外語表
    華語指標 = 新增外語詞('華語', row['華語對譯'])
    英文指標 = 新增外語詞('英文', row['英文'])
    # Step 2. 將它們對應的台語詞加到文本表
    新增母語詞(華語指標, row['台語羅馬字'], row['台語漢字'])
    新增母語詞(英文指標, row['台語羅馬字'], row['台語漢字'])

顯示表格()
```

在終端機執行看看：
```bash
python manage.py shell 

>>> (在這邊貼上程式碼)
```

顯示結果會像這樣。
```bash
===外語表===
{id: 1, 外語資料: '曾祖父母', ...}
{id: 2, 外語資料: 'grandparents', ...}
{id: 3, 外語資料: '爺爺', ...}
{id: 4, 外語資料: 'grandfather', ...}
{id: 5, 外語資料: '媽媽', ...}
{id: 6, 外語資料: 'mother', ...}
===文本表===
{id: 1, 音標資料: 'a-chou2', 文本資料: '阿祖', ...}
{id: 2, 音標資料: 'a-chou2', 文本資料: '阿祖', ...}
{id: 3, 音標資料: 'a-kong', 文本資料: '阿公', ...}
{id: 4, 音標資料: 'a-kong', 文本資料: '阿公', ...}
{id: 5, 音標資料: 'a-bo2', 文本資料: '阿母', ...}
{id: 6, 音標資料: 'a-bo2' 文本資料: '阿母', ...}
===翻譯文本表===
{外語: 1, id: 1, 文本: 1}
{外語: 2, id: 2, 文本: 2}
{外語: 3, id: 3, 文本: 3}
{外語: 4, id: 4, 文本: 4}
{外語: 5, id: 5, 文本: 5}
{外語: 6, id: 6, 文本: 6}
```

